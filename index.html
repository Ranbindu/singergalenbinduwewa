<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Shop Cam & Calculator</title>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <script src="https://cdn.tailwindcss.com"></script>

    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
    </style>
</head>
<body class="bg-slate-50 text-slate-800">

    <div id="root"></div>

    <script type="text/babel">
        // --- Firebase Config ---
        const firebaseConfig = {
            apiKey: "AIzaSyAifmX-sw2S85AdkbEUVnzAk9iOtgJiz4c",
            authDomain: "singer-galenbindunuwewa.firebaseapp.com",
            projectId: "singer-galenbindunuwewa",
            storageBucket: "singer-galenbindunuwewa.firebasestorage.app",
            messagingSenderId: "444869449554",
            appId: "1:444869449554:web:99e66a83595a358a074c8b",
            measurementId: "G-D8E4KB45P8"
        };

        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        const auth = firebase.auth();
        const db = firebase.firestore();

        // --- Icons ---
        const Icons = {
            Camera: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z"/><circle cx="12" cy="13" r="3"/></svg>,
            Search: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>,
            X: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>,
            Plus: () => <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>,
            LogOut: () => <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>,
            Image: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/></svg>,
            Calc: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="4" y="2" width="16" height="20" rx="2" ry="2"/><line x1="12" y1="6" x2="12" y2="6"/><line x1="16" y1="6" x2="16" y2="6"/><line x1="8" y1="6" x2="8" y2="6"/><line x1="12" y1="10" x2="12" y2="10"/><line x1="16" y1="10" x2="16" y2="10"/><line x1="8" y1="10" x2="8" y2="10"/><line x1="12" y1="14" x2="12" y2="14"/><line x1="16" y1="14" x2="16" y2="14"/><line x1="8" y1="14" x2="8" y2="14"/><line x1="12" y1="18" x2="12" y2="18"/><line x1="16" y1="18" x2="16" y2="18"/><line x1="8" y1="18" x2="8" y2="18"/></svg>
        };

        const { useState, useEffect, useRef } = React;

        function App() {
            const [user, setUser] = useState(null);
            const [view, setView] = useState('auth'); 
            const [loading, setLoading] = useState(true);
            const [notification, setNotification] = useState(null);

            useEffect(() => {
                const unsubscribe = auth.onAuthStateChanged((currentUser) => {
                    setUser(currentUser);
                    setLoading(false);
                    setView(currentUser ? 'home' : 'auth');
                });
                return () => unsubscribe();
            }, []);

            const showNotify = (msg, type = 'success') => {
                setNotification({ msg, type });
                setTimeout(() => setNotification(null), 4000);
            };

            const handleLogout = async () => {
                await auth.signOut();
                showNotify("Logged out successfully");
            };

            if (loading) return <div className="min-h-screen flex items-center justify-center">System Loading...</div>;

            return (
                <div className="min-h-screen pb-24">
                    {user && (
                        <header className="bg-blue-600 text-white p-4 shadow-md sticky top-0 z-50">
                            <div className="max-w-md mx-auto flex justify-between items-center">
                                <div className="flex items-center gap-2 font-bold text-lg" onClick={() => setView('home')}>
                                    <Icons.Camera /> <span>Smart Shop</span>
                                </div>
                                <button onClick={handleLogout} className="text-xs bg-blue-700 px-3 py-1.5 rounded flex items-center gap-1">
                                    <Icons.LogOut /> Logout
                                </button>
                            </div>
                        </header>
                    )}

                    <main className="max-w-md mx-auto p-4">
                        {!user ? (
                            <AuthView showNotify={showNotify} />
                        ) : (
                            <>
                                {view === 'home' && <HomeView setView={setView} user={user} />}
                                {view === 'add' && <AddCustomerView user={user} setView={setView} showNotify={showNotify} />}
                                {view === 'search' && <SearchView user={user} setView={setView} showNotify={showNotify} />}
                                {view === 'calc' && <CalculatorView setView={setView} />}
                            </>
                        )}
                    </main>

                    {notification && (
                        <div className={`fixed bottom-4 left-4 right-4 p-4 rounded-lg shadow-lg text-white text-center z-50 ${notification.type === 'error' ? 'bg-red-500' : 'bg-green-600'}`}>
                            {notification.msg}
                        </div>
                    )}
                </div>
            );
        }

        function AuthView({ showNotify }) {
            const [isLogin, setIsLogin] = useState(true);
            const [email, setEmail] = useState('');
            const [password, setPassword] = useState('');
            const [processing, setProcessing] = useState(false);

            const handleSubmit = async (e) => {
                e.preventDefault();
                setProcessing(true);
                try {
                    if (isLogin) {
                        await auth.signInWithEmailAndPassword(email, password);
                        showNotify("Welcome back!");
                    } else {
                        await auth.createUserWithEmailAndPassword(email, password);
                        showNotify("Account created!");
                    }
                } catch (error) {
                    showNotify(error.message, "error");
                } finally {
                    setProcessing(false);
                }
            };

            return (
                <div className="flex flex-col items-center justify-center min-h-[80vh]">
                    <div className="bg-white p-8 rounded-2xl shadow-xl w-full max-w-sm border">
                        <div className="flex justify-center mb-6"><div className="bg-blue-100 p-4 rounded-full text-blue-600"><Icons.Camera /></div></div>
                        <h2 className="text-2xl font-bold text-center mb-2">{isLogin ? 'Login' : 'Sign Up'}</h2>
                        <form onSubmit={handleSubmit} className="space-y-4">
                            <div><label className="block text-sm font-medium text-gray-700">Email</label><input type="email" value={email} onChange={e=>setEmail(e.target.value)} className="w-full p-3 border rounded-lg" required /></div>
                            <div><label className="block text-sm font-medium text-gray-700">Password</label><input type="password" value={password} onChange={e=>setPassword(e.target.value)} className="w-full p-3 border rounded-lg" required /></div>
                            <button type="submit" disabled={processing} className="w-full bg-blue-600 text-white py-3 rounded-lg font-bold">{processing ? 'Processing...' : (isLogin ? 'Login' : 'Sign Up')}</button>
                        </form>
                        <button onClick={() => setIsLogin(!isLogin)} className="mt-4 text-blue-600 text-sm w-full text-center hover:underline">{isLogin ? "Need an account? Sign Up" : "Have an account? Login"}</button>
                    </div>
                </div>
            );
        }

        function HomeView({ setView, user }) {
            return (
                <div className="flex flex-col gap-4 mt-4">
                    <div className="text-center mb-2"><h2 className="text-xl font-bold">Hello!</h2><p className="text-gray-500 text-xs">{user.email}</p></div>
                    
                    <button onClick={() => setView('add')} className="flex items-center gap-4 bg-blue-600 text-white p-5 rounded-2xl shadow-lg active:scale-95 transition-transform">
                        <Icons.Plus /><div className="text-left"><div className="font-bold text-lg">New Customer</div><div className="text-blue-100 text-sm">නව පාරිභෝගිකයා</div></div>
                    </button>
                    
                    <button onClick={() => setView('search')} className="flex items-center gap-4 bg-white text-gray-700 p-5 rounded-2xl shadow-md border active:scale-95 transition-transform">
                        <Icons.Search /><div className="text-left"><div className="font-bold text-lg">Find Customer</div><div className="text-gray-500 text-sm">සොයන්න (Search)</div></div>
                    </button>

                    <button onClick={() => setView('calc')} className="flex items-center gap-4 bg-green-50 text-green-700 p-5 rounded-2xl shadow-md border border-green-200 active:scale-95 transition-transform">
                        <div className="bg-green-100 p-2 rounded-full"><Icons.Calc /></div>
                        <div className="text-left"><div className="font-bold text-lg">Calculator</div><div className="text-green-600 text-sm">වාරික ගණනය (Down Payment)</div></div>
                    </button>
                </div>
            );
        }

        // --- NEW: Calculator with Down Payment ---
        function CalculatorView({ setView }) {
            const [price, setPrice] = useState('');
            const [rate, setRate] = useState(10); // Interest Rate
            const [months, setMonths] = useState(12);
            const [downPaymentPercent, setDownPaymentPercent] = useState(30); // Default Down Payment %

            // --- Calculation Logic (ගණනය කිරීම්) ---
            const itemPrice = parseFloat(price) || 0;
            
            // 1. Calculate Down Payment (මූලික ගෙවීම)
            const downPaymentAmount = itemPrice * (downPaymentPercent / 100);
            
            // 2. Calculate Balance to be paid (ණය මුදල)
            const loanBalance = itemPrice - downPaymentAmount;

            // 3. Calculate Interest on the Balance (ඉතිරි මුදලට පොලිය)
            const interestAmount = loanBalance * (rate / 100);
            
            // 4. Final amounts
            const totalPayableLoan = loanBalance + interestAmount;
            const monthlyInstallment = months > 0 ? totalPayableLoan / months : 0;
            const totalCostForCustomer = downPaymentAmount + totalPayableLoan; // Downpayment + Installments

            return (
                <div className="flex flex-col h-full">
                    <div className="flex justify-between items-center mb-6">
                        <h2 className="text-xl font-bold flex items-center gap-2"><Icons.Calc /> Calculator</h2>
                        <button onClick={() => setView('home')} className="p-2 bg-gray-200 rounded-full"><Icons.X /></button>
                    </div>

                    <div className="space-y-4">
                        {/* Inputs Section */}
                        <div className="bg-white p-4 rounded-xl shadow-sm border space-y-4">
                            <div>
                                <label className="block text-sm font-bold text-gray-700 mb-1">Item Price (භාණ්ඩයේ මිල)</label>
                                <div className="relative">
                                    <span className="absolute left-3 top-3 text-gray-500">Rs.</span>
                                    <input type="number" value={price} onChange={e => setPrice(e.target.value)} className="w-full p-3 pl-10 border rounded-lg font-bold text-lg" placeholder="0.00" />
                                </div>
                            </div>

                            <div className="grid grid-cols-2 gap-3">
                                <div>
                                    <label className="block text-xs font-bold text-gray-700 mb-1">Down Payment %</label>
                                    <div className="flex items-center border rounded-lg overflow-hidden">
                                        <input type="number" value={downPaymentPercent} onChange={e => setDownPaymentPercent(e.target.value)} className="w-full p-2 text-center font-bold text-blue-600" />
                                        <span className="bg-gray-100 p-2 text-gray-500 text-sm">%</span>
                                    </div>
                                    <div className="text-[10px] text-gray-400 mt-1">මූලික ගෙවීම (Default 30%)</div>
                                </div>
                                <div>
                                    <label className="block text-xs font-bold text-gray-700 mb-1">Interest % (පොලිය)</label>
                                    <div className="flex items-center border rounded-lg overflow-hidden">
                                        <input type="number" value={rate} onChange={e => setRate(e.target.value)} className="w-full p-2 text-center" />
                                        <span className="bg-gray-100 p-2 text-gray-500 text-sm">%</span>
                                    </div>
                                </div>
                            </div>

                            <div>
                                <label className="block text-sm font-bold text-gray-700 mb-1">Months (වාරික මාස ගණන)</label>
                                <select value={months} onChange={e => setMonths(Number(e.target.value))} className="w-full p-3 border rounded-lg bg-white">
                                    <option value="3">3 Months</option>
                                    <option value="6">6 Months</option>
                                    <option value="12">12 Months</option>
                                    <option value="18">18 Months</option>
                                    <option value="24">24 Months</option>
                                    <option value="36">36 Months</option>
                                    <option value="48">48 Months</option>
                                </select>
                            </div>
                        </div>

                        {/* Results Section */}
                        
                        {/* 1. Down Payment Card (Pay Now) */}
                        <div className="bg-orange-50 border border-orange-200 p-4 rounded-xl flex justify-between items-center">
                            <div>
                                <div className="text-orange-800 font-bold text-sm">Down Payment (ගෙවිය යුතු මූලික මුදල)</div>
                                <div className="text-xs text-orange-600">{downPaymentPercent}% of Price</div>
                            </div>
                            <div className="text-xl font-bold text-orange-700">Rs. {downPaymentAmount.toLocaleString('en-US', {maximumFractionDigits: 0})}</div>
                        </div>

                        {/* 2. Monthly Installment Card (Pay Later) */}
                        <div className="bg-blue-600 text-white p-6 rounded-2xl shadow-lg space-y-4">
                             <div className="text-center">
                                <div className="text-blue-200 text-xs uppercase font-bold tracking-wider mb-1">Monthly Installment (මාසික වාරිකය)</div>
                                <div className="text-4xl font-extrabold">Rs. {monthlyInstallment.toLocaleString('en-US', {maximumFractionDigits: 0})}</div>
                                <div className="text-sm text-blue-200 mt-1">for {months} months</div>
                            </div>

                            <div className="border-t border-blue-400 pt-3 text-sm space-y-1">
                                <div className="flex justify-between text-blue-100">
                                    <span>Loan Balance (ණය මුදල):</span>
                                    <span>Rs. {loanBalance.toLocaleString()}</span>
                                </div>
                                <div className="flex justify-between text-yellow-300">
                                    <span>Total Interest ({rate}%):</span>
                                    <span>+ Rs. {interestAmount.toLocaleString()}</span>
                                </div>
                                <div className="flex justify-between font-bold pt-2 border-t border-blue-500 mt-2">
                                    <span>Total Price (Full Cost):</span>
                                    <span>Rs. {totalCostForCustomer.toLocaleString()}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        function AddCustomerView({ user, setView, showNotify }) {
            const [formData, setFormData] = useState({ name: '', nic: '' });
            const [photos, setPhotos] = useState([]);
            const [isCameraOpen, setIsCameraOpen] = useState(false);
            const [cameraError, setCameraError] = useState(null);
            const [saving, setSaving] = useState(false);
            const videoRef = useRef(null);
            
            const MAX_PHOTOS = 3;
            const MAX_WIDTH = 480; 
            const COMPRESSION_QUALITY = 0.4;

            const startCamera = async () => {
                if (photos.length >= MAX_PHOTOS) {
                    return showNotify(`Only ${MAX_PHOTOS} photos allowed.`, "error");
                }
                setIsCameraOpen(true);
                setCameraError(null);
                try {
                    const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } });
                    if (videoRef.current) videoRef.current.srcObject = stream;
                } catch (err) { 
                    setCameraError("Camera blocked! Use HTTPS or Localhost.");
                }
            };

            const capturePhoto = () => {
                if (!videoRef.current || !videoRef.current.srcObject) return;
                const video = videoRef.current;
                const canvas = document.createElement('canvas');
                let width = video.videoWidth;
                let height = video.videoHeight;
                if (width > MAX_WIDTH) {
                    height = height * (MAX_WIDTH / width);
                    width = MAX_WIDTH;
                }
                canvas.width = width;
                canvas.height = height;
                canvas.getContext('2d').drawImage(video, 0, 0, width, height); 
                const base64 = canvas.toDataURL('image/jpeg', COMPRESSION_QUALITY); 
                setPhotos([...photos, base64]);
                if (video.srcObject) {
                    video.srcObject.getTracks().forEach(track => track.stop());
                }
                setIsCameraOpen(false);
            };

            const closeCamera = () => {
                if (videoRef.current && videoRef.current.srcObject) {
                    videoRef.current.srcObject.getTracks().forEach(track => track.stop());
                }
                setIsCameraOpen(false);
            }
            
            const handleGallerySelect = (event) => {
                if (photos.length >= MAX_PHOTOS) {
                    showNotify(`Only ${MAX_PHOTOS} photos allowed.`, "error");
                    event.target.value = null;
                    return;
                }
                const file = event.target.files[0];
                if (!file || !file.type.startsWith('image/')) {
                    showNotify("Please select an image file", "error");
                    event.target.value = null;
                    return;
                }
                const reader = new FileReader();
                reader.onload = (e) => {
                    const img = new Image();
                    img.onload = () => {
                        const canvas = document.createElement('canvas');
                        let width = img.width;
                        let height = img.height;
                        if (width > MAX_WIDTH) {
                            height = height * (MAX_WIDTH / width);
                            width = MAX_WIDTH;
                        }
                        canvas.width = width;
                        canvas.height = height;
                        canvas.getContext('2d').drawImage(img, 0, 0, width, height);
                        const base64 = canvas.toDataURL('image/jpeg', COMPRESSION_QUALITY); 
                        setPhotos(prevPhotos => [...prevPhotos, base64]);
                    };
                    img.src = e.target.result;
                };
                reader.readAsDataURL(file);
                event.target.value = null;
            };

            const handleSave = async () => {
                if (!formData.name || !formData.nic || photos.length === 0) {
                    return showNotify("Fill details & take photos", "error");
                }
                setSaving(true);
                try {
                    const nic = formData.nic.trim().toUpperCase();
                    const docRef = db.collection('artifacts').doc('shop-app').collection('users').doc(user.uid).collection('customers').doc(nic);
                    const docSnap = await docRef.get();
                    if (docSnap.exists) {
                         showNotify("Customer already exists!", "error");
                         setSaving(false);
                         return; 
                    }
                    await docRef.set({
                        name: formData.name, 
                        nic: nic, 
                        photos, 
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    showNotify("Saved Successfully!"); 
                    setTimeout(() => setView('home'), 1000);
                } catch (e) { 
                    showNotify("Error saving customer", "error");
                } finally {
                    setSaving(false);
                }
            };

            return (
                <div className="flex flex-col h-full">
                    <div className="flex justify-between items-center mb-6"><h2 className="text-xl font-bold">New Customer</h2><button onClick={() => setView('home')} className="p-2 bg-gray-200 rounded-full"><Icons.X /></button></div>
                    <div className="space-y-4 pb-20">
                        <input type="text" placeholder="NIC Number" className="w-full p-3 border rounded-lg uppercase" value={formData.nic} onChange={e => setFormData({...formData, nic: e.target.value.toUpperCase()})} maxLength={200} />
                        <input type="text" placeholder="Full Name" className="w-full p-3 border rounded-lg" value={formData.name} onChange={e => setFormData({...formData, name: e.target.value})} />
                        
                        <div className="text-gray-600 text-sm font-semibold mt-4">Photos ({photos.length}/{MAX_PHOTOS})</div>
                        <div className="grid grid-cols-3 gap-2">
                            {photos.map((p, i) => <div key={i} className="relative aspect-square"><img src={p} className="w-full h-full object-cover rounded-lg" /><button onClick={() => setPhotos(photos.filter((_, idx) => idx !== i))} className="absolute top-0 right-0 bg-red-500 text-white p-1 rounded-full text-xs opacity-70 hover:opacity-100"><Icons.X /></button></div>)}
                            {photos.length < MAX_PHOTOS && (
                                <>
                                    <button onClick={startCamera} className="aspect-square flex flex-col items-center justify-center bg-blue-50 border-2 border-dashed border-blue-200 text-blue-600 rounded-lg p-2 transition hover:bg-blue-100">
                                        <Icons.Camera /><span className="text-xs mt-1">Camera</span>
                                    </button>
                                    <input type="file" id="galleryInput" accept="image/*" onChange={handleGallerySelect} className="hidden" />
                                    <button onClick={() => document.getElementById('galleryInput').click()} className="aspect-square flex flex-col items-center justify-center bg-green-50 border-2 border-dashed border-green-200 text-green-600 rounded-lg p-2 transition hover:bg-green-100">
                                        <Icons.Image /><span className="text-xs mt-1">Gallery</span>
                                    </button>
                                </>
                            )}
                        </div>
                    </div>
                    <div className="fixed bottom-0 left-0 right-0 p-4 bg-white border-t"><button onClick={handleSave} disabled={saving} className="w-full bg-blue-600 text-white py-3 rounded-lg font-bold">{saving ? 'Saving...' : 'Save Customer'}</button></div>
                    
                    {isCameraOpen && (
                        <div className="fixed inset-0 z-50 bg-black flex flex-col">
                            <div className="flex-1 flex items-center justify-center overflow-hidden relative">
                                {cameraError ? (
                                    <div className="text-white text-center p-4">
                                        <div className="text-red-500 text-4xl mb-2">⚠️</div>
                                        <p className="font-bold">Camera Blocked</p>
                                    </div>
                                ) : (
                                    <video ref={videoRef} autoPlay playsInline className="w-full h-full object-cover" />
                                )}
                                <button onClick={closeCamera} className="absolute top-4 right-4 bg-white/20 p-2 rounded-full text-white"><Icons.X /></button>
                            </div>
                            {!cameraError && (
                                <div className="h-24 flex items-center justify-center bg-black/80">
                                    <button onClick={capturePhoto} className="w-16 h-16 bg-white rounded-full border-4 border-gray-300"></button>
                                </div>
                            )}
                        </div>
                    )}
                </div>
            );
        }

        function SearchView({ user, setView, showNotify }) {
            const [searchNic, setSearchNic] = useState('');
            const [result, setResult] = useState(null);
            const [searching, setSearching] = useState(false);

            const handleSearch = async () => {
                if(!searchNic) return;
                setSearching(true); setResult(null);
                try {
                    const doc = await db.collection('artifacts').doc('shop-app').collection('users').doc(user.uid).collection('customers').doc(searchNic.trim().toUpperCase()).get();
                    if(doc.exists) {
                        setResult(doc.data());
                        showNotify("Customer Found");
                    }
                    else {
                        showNotify("Customer Not Found", "error");
                    }
                } catch(e) { 
                    showNotify("Error searching", "error"); 
                }
                setSearching(false);
            };

            return (
                <div className="flex flex-col h-full">
                    <div className="flex justify-between items-center mb-6"><h2 className="text-xl font-bold">Find Customer</h2><button onClick={() => setView('home')} className="p-2 bg-gray-200 rounded-full"><Icons.X /></button></div>
                    <div className="flex gap-2 mb-6"><input type="text" placeholder="Enter NIC" className="w-full p-3 border rounded-lg uppercase" value={searchNic} onChange={e => setSearchNic(e.target.value.toUpperCase())} /><button onClick={handleSearch} disabled={searching} className="bg-blue-600 text-white px-4 rounded-lg">{searching ? '...' : 'Go'}</button></div>
                    
                    {result && (
                        <div className="bg-white rounded-xl shadow border overflow-hidden">
                            <div className="p-4 bg-gray-50 border-b">
                                <h3 className="font-bold">{result.name}</h3>
                                <p className="text-blue-600 text-sm">{result.nic}</p>
                            </div>
                            <div className="p-4 grid grid-cols-2 gap-4">
                                {result.photos.map((p, i) => <img key={i} src={p} className="w-full rounded-lg border shadow-sm" />)}
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>